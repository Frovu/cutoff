<!DOCTYPE html>
<html lang="en">

<html>
<head>
   <meta charset="utf-8">
   <!--<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">-->

   <title>Cutoff Calculator</title>

   <link rel="stylesheet" type="text/css" href="./css/bootstrap.css">
   <link rel="stylesheet" type="text/css" href="./css/custom.css">
   <link rel="stylesheet" type="text/css" href="./css/simple-sidebar.css">
</head>
<body>
    <div class="d-flex" id="wrapper">

        <!-- sidebar -->
        <div class="bg-light border-right" id="sidebar-wrapper">
            <div class="sidebar-heading">Cutoff Calculator</div>
            <div class="list-group list-group-flush">

                <!--<a href="#" class="list-group-item list-group-item-action bg-light">Instance #1</a>-->

                <!--
                <a href="#" class="list-group-item list-group-item-action flex-column align-items-start ">
                    <div class="d-flex w-100 justify-content-between">
                       <h5 class="mb-1">Irkutsk</h5>
                       <small class="text-muted">Done</small>
                   </div>
                   <p class="mb-1">
                        <i>Energy: 0.00 - 6.00 GV<br>
                        Date: 27.01.2007<br>
                        Time: 23:00<br>
                        </i>
                    </p>
                </a>-->

                <a class="list-group-item list-group-item-action flex-column align-items-start" onclick="show_instance_modal()">
                    <div class="d-flex w-100 justify-content-between">
                        <h5 class="mb-1">Create New Calculation...</h5>
                    </div>
                </a>

                <div id="instances-list"></div>
            </div>
        </div>

        <!-- page content -->
        <div id="page-content-wrapper">
            <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="           #navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"       aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon"></span>
              </button>

              <div class="collapse navbar-collapse" id="navbarSupportedContent">
                  <ul class="navbar-nav ml-auto mt-2 mt-lg-0">
                        <!--
                        <li class="nav-item active">
                          <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" href="#">Link</a>
                      </li>-->
                        <a class="nav-link" onclick="show_help_modal()" id="navbarHelpButton" role="button">
                            <svg class="t7 text-muted" xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewBox="0 0 24 24" fill="#7C7C7D" focusable="false"><path fill="none" d="M0 0h24v24H0z"></path><path d="M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"></path></svg>
                            Help
                        </a>
                        <a class="nav-link" onclick="show_login_modal()" id="navbarLoginButton" role="button">
                            Log in
                        </a>

                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" id="navbarUsernameDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="display:none">
                            Logged in as .</a>
                            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                            <!--<div class="dropdown-divider"></div>-->
                            <a class="dropdown-item" onclick="logout();">Logout</a>
                        </div>
                      </li>
                  </ul>
            </div>
        </nav>


        <div style="background-color: black;">
            <div>
                <div class="alert alert-danger alert-dismissible fade show" id="error_alert" style="margin-bottom:0px;display:none;width:100%;" role="alert">
                <p id="error_text"></p>
                <button type="button" class="close" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div id="info" style="font-size: 15px"></div>
            <canvas class="center" id="earth"></canvas>
            <div class="mt-2 d-flex justify-content-center">
                <div class="spinner-border text-light" id="trace-spinner" style="visibility:hidden" role="status"></div>
            </div>

            <a><img src="arrow_left.png" class="arrow noselect" id="arrow_left" style="visibility:hidden" onclick="move_penumbra_left()"></a>
            <a><img src="arrow_right.png" class="arrow noselect" id="arrow_right" style="visibility:hidden" onclick="move_penumbra_right()"></a>
            <canvas class="center" id="time_graph"></canvas>

            <div id="penumbras-container"></div>

            <!--
            <small class="mt-2 form-text center" style="color: white">
                Drag mouse on the animation to rotate, scroll to zoom<br>
                Navigate through penumbra by mouse click or arrow keys
            </small>-->

            </div>
        </div>
    </div>
</div>

<!-- instance modal -->

<div class="modal fade" id="instance_modal" tabindex="-1" role="dialog" aria-labelledby="login"   aria-hidden=  "true">
  <div class="modal-dialog modal-dialog-centered" data-focus="false" role="document" style="min-width: 900px">
    <div class="modal-content">
            <div class="col-md-2" style="min-width: 900px; padding-top: 15px; padding-bottom: 25px; padding-left: 30px; padding-right: 25px;">
                <div class="mt-2 row">
                    <div class="col-md-3">
                        <div class="dropdown" id="modelDd">
                            <button class="btn btn-outline-secondary dropdown-toggle btn-block rounded" type="button" id="model" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Geomagnetic Field Model</button>

                            <div class="dropdown-menu" aria-labelledby="model">
                                <a onclick='change_model(this.innerHTML)' class="dropdown-item">Dipole</a>
                                <a onclick='change_model(this.innerHTML)' class="dropdown-item">IGRF</a>
                                <a onclick='change_model(this.innerHTML)' class="dropdown-item">IGRF+T89</a>
                                <a onclick='change_model(this.innerHTML)' class="dropdown-item">IGRF+T96</a>
                                <a onclick='change_model(this.innerHTML)' class="dropdown-item">IGRF+T01</a>
                                <a onclick='change_model(this.innerHTML)' class="dropdown-item">IGRF+T01_S</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <label class="col-form-label" for="name">Name (optional)</label>
                        <input class="form-control rounded" type="text" id="name" value="">
                    </div>
                    <div class="col-md-3">
                        <label class="col-form-label" for="date">Launch Date</label>
                        <input class="form-control rounded" type="text" id="date" value="2020.01.01">
                        <small id="dateHelp" class="form-text text-muted">Format: yyyy-mm-dd</small>
                    </div>
                    <div class="col-md-3">
                        <label class="col-form-label" for="time">Launch Time</label>
                        <input class="form-control rounded" type="text" id="time" value="12:00:00">
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-3">
                        <label id="kp-label" class="col-form-label" for="kp">Kp-index</label>
                        <input class="form-control rounded" type="text" id="kp" value="2">
                    </div>
                    <div class="col-md-3">
                        <label id="swdp-label" class="col-form-label" for="swdp">SWDP</label>
                        <input class="form-control rounded" type="text" id="swdp" value="0.5">
                    </div>
                    <div class="col-md-3">
                        <label id="dst-label"class="col-form-label" for="dst">Dst-index</label>
                        <input class="form-control rounded" type="text" id="dst" value="-30.0">
                    </div>
                    <div class="col-md-3">
                        <label id="imfBy-label" class="col-form-label" for="imfBy">IMF By</label>
                        <input class="form-control rounded" type="text" id="imfBy" value="-7.8">
                    </div>
                    <div class="col-md-3">
                        <label id="imfBz-label" class="col-form-label" for="imfBz">IMF Bz</label>
                        <input class="form-control rounded" type="text" id="imfBz" value="-2.9">
                    </div>
                </div>
                <div class="mt-2 row">
                    <div class="col-md-3">
                        <label id="g1-label" class="col-form-label" for="g1">G1</label>
                        <input class="form-control rounded" type="text" id="g1" value="1.8">
                    </div>
                    <div class="col-md-3">
                        <label id="g2-label" class="col-form-label" for="g2">G2</label>
                        <input class="form-control rounded" type="text" id="g2" value="7.0">
                    </div>
                    <div class="col-md-3">
                        <label id="g3-label" class="col-form-label" for="g3">G3</label>
                        <input class="form-control rounded" type="text" id="g3" value="10.0">
                    </div>
                </div>

                <legend>Launch Direction</legend>
                <div class="row">
                    <div class="col-md-3">
                        <label class="col-form-label" for="alt">Altitude (km)</label>
                        <input class="form-control rounded" type="text" id="alt" value="20.0">
                        <small class="form-text text-muted">Height above sea level in kilometers</small>
                    </div>
                    <div class="col-md-3">
                        <label class="col-form-label" for="vertical">Vertical angle (deg)</label>
                        <input class="form-control rounded" type="text" id="vertical" value="0.00">
                    </div>
                    <div class="col-md-3">
                        <label class="col-form-label" for="azimutal">Azimutal angle (deg)</label>
                        <input class="form-control rounded" type="text" id="azimutal" value="0.00">
                    </div>
                    <div class="col-md-3">
                        <label class="col-form-label" for="flightTime">Particle flight time (seconds)</label>
                        <input class="form-control rounded" type="text" id="flightTime" value="8.0">
                    </div>
                </div>

                <legend>Launch Location</legend>
                <div class="row">
                    <div class="col-md-3">
                        <div class="dropdown" id="stationDd">
                            <button class="btn btn-outline-secondary dropdown-toggle btn-block rounded" type="button" id="station" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Select station<span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu scrollable-menu" id="stationDropdown">
                                <input type="text" placeholder="Search.." id="stationSearchButton" onkeyup="dropdown_filter()">
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <label class="col-form-label" for="lat">Latitude</label>
                        <input class="form-control rounded" type="text" id="lat" value="">
                    </div>
                    <div class="col-md-3">
                        <label class="col-form-label" for="lon">Longitude</label>
                        <input class="form-control rounded" type="text" id="lon" value="">
                    </div>
                    <div class="col-md-3">
                        <button type="button" class="btn btn-secondary btn-block rounded" id="map" onclick="on_map(document.getElementById('lat').  value, document.getElementById('lon').value)">Show on map</button>
                    </div>
                </div>

                <legend>Rigidity</legend>
                <div class="row">
                    <div class="col-md-3">
                        <label class="col-form-label" for="lower">Lowest rigidity (GV)</label>
                        <input class="form-control rounded" type="text" id="lower" value="0.00">
                    </div>
                    <div class="col-md-3">
                        <label class="col-form-label" for="upper">Highest rigidity (GV)</label>
                        <input class="form-control rounded" type="text" id="upper" value="6.00">
                    </div>
                    <div class="col-md-3">
                                <!--
                                <label class="col-form-label" for="step">Rigidity step (GV)</label>
                                <input class="form-control rounded" type="number" id="step" value="0.01" min="0.001" max="0.1" step="0.01">
                                <small class="form-text text-muted">From 0.1 to 0.001 GV</small>
                            -->

                            <span class="dropdown">
                                <button class="btn btn-outline-secondary dropdown-toggle btn-block rounded" type="button" id="step" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Rigidity step (GV)</button>

                                <span class="dropdown-menu" aria-labelledby="step">
                                    <a onclick="change_step(this.innerHTML)" class="dropdown-item">0.1 GV</a>
                                    <a onclick="change_step(this.innerHTML)" class="dropdown-item">0.01 GV</a>
                                    <a onclick="change_step(this.innerHTML)" class="dropdown-item">0.001 GV</a>
                                </span>
                                <span class="dropdown">
                                </div>
                                <div class="col-md-3">
                                    <button type="button" class="btn btn-primary btn-block rounded" id="submit" onclick="submit()">Calculate</button>
                                </div>
                            </div>

                            <!--
                            <div class="progress bg-gray ml-2 mt-5" style="width: 100%; margin-top: 15px; height: 30px">
                                <div id="progress" class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="  width: 0%; font-size: 16;"></div>
                            </div>

                            <hr>
                            <legend class="ml-1">Visuals</legend>
                            <div class="row ml-1" id="options">
                                <div class="col-md-3">
                                    <label class="col-form-label" for="cameraSpeed">Camera speed</label>
                                    <input class="form-control rounded" type="text" id="cameraSpeed" value="1">
                                </div>
                                <div class="col-md-3">
                                    <label class="col-form-label" for="energy">Energy</label>
                                    <input class="form-control rounded" type="number" id="energy" value="0" onchange="change_energy(this.value)">
                                </div>
                                <div class="col-md-3">
                                    <label class="col-form-label" for="gifTime">Record for (seconds)</label>
                                    <input class="form-control rounded" type="text" id="gifTime" value="6.0">
                                </div>
                                <div class="col-md-3">
                                    <button type="button" class="btn btn-secondary btn-block rounded" onclick="makeGif();">Start recording</button>
                                </div>
                            </div>-->
                            <!--
                            <div class="col-md-3">
                                <label class="col-form-label" for="energy">Energy</label>
                                <input class="form-control rounded" type="number" id="energy" value="0" onchange="change_energy(this.value)">
                            </div>-->
                        </div>
                </div>
            </div>
        </div>

        <!-- login modal -->
        <div class="modal fade" id="login_modal" tabindex="-1" role="dialog" aria-labelledby="login"   aria-hidden=  "true">
          <div class="modal-dialog modal-dialog-centered" role="document" style="max-width: 300px">
            <div class="modal-content">
                <div class="login-form ml-2 mr-2 mt-2 mb-2">
                    <form>
                        <h4 class="text-center">Log in</h2>
                            <div class="form-group">
                                <input id="login-email" type="text" class="form-control" placeholder="E-mail" required="required">
                            </div>
                            <div class="form-group">
                                <input id="login-password" type="password" class="form-control" placeholder="Password" required="required">
                            </div>
                            <div class="form-group">
                                <button type="button" class="btn btn-primary btn-block" onclick="login()">Log in</button>
                            </div>
                        <!--
                        <div class="clearfix">
                            <label class="pull-left checkbox-inline"><input type="checkbox"> Remember me</label>
                            <a href="#" class="pull-right">Forgot Password?</a>
                        </div>
                    -->
                </form>
                <p class="text-center"><a href="#" onclick="show_register_modal()">New user</a></p>
            </div>
        </div>
    </div>
</div>

<!-- register modal -->
<div class="modal fade" id="register_modal" tabindex="-1" role="dialog" aria-labelledby="login"   aria-hidden=  "true">
  <div class="modal-dialog modal-dialog-centered" role="document" style="max-width: 300px">
    <div class="modal-content">
        <div class="login-form ml-2 mr-2 mt-2 mb-2">
            <form>
                <h4 class="text-center">Register</h2>
                    <div class="form-group">
                        <input id="reg-email" type="text" class="form-control" placeholder="E-mail" required="required">
                    </div>
                    <div class="form-group">
                        <input id="reg-password" type="password" class="form-control" placeholder="Password" required="required">
                    </div>
                    <div class="form-group">
                        <input id="reg-confirm-password" type="password" class="form-control" placeholder="Confirm Password" required="required">
                    </div>
                    <div class="form-group">
                        <button type="button" onclick="register();" class="btn btn-primary btn-block">Register</button>
                    </div>
                </form>
                <p class="text-center"><a href="#" onclick="show_login_modal()">Log in</a></p>
            </div>
        </div>
    </div>
</div>

<!-- help modal -->
<div class="modal fade" id="help_modal" tabindex="-1" role="dialog" aria-labelledby="help" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">

      <div class="modal-body">
        <ul class="nav nav-tabs">
          <li class="nav-item">
            <a class="nav-link" id="settings_help_tab" onclick="select_help_tab('settings');" href="#">1. Settings</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="instances_help_tab" onclick="select_help_tab('instances');" href="#">2. Calculations</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="rigidities_help_tab" onclick="select_help_tab('rigidities');" href="#">3. Rigidities</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="trajectories_help_tab" onclick="select_help_tab('trajectories');" href="#">4. Trajectories</a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-info" id="advices_help_tab" onclick="select_help_tab('advices');" href="#"><i>Advices</i></a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-info" id="physics_help_tab" onclick="select_help_tab('physics');" href="#"><i>Physics</i></a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-info" id="credit_help_tab" onclick="select_help_tab('credit');" href="#"><i>Credit</i></a>
          </li>
        </ul>
        <br>
        <span id="startup_help_text">
        First, <b>log in</b> or create a new account with your <i>e-mail</i> and <i>password.</i><br>Then, view this manual in order, clicking on tabs on top.
        </span>

        <span id="settings_help_text">
        <h4>Calculation Settings</h4>
        Click on the <b>Create New Calculation...</b> button. A window with your <b>calculation settings</b> will pop-up. For a quick test you can select a station from the list and click <b>Calculate</b> button.<br><br>

        When choosing different magnetosphere models, new settings may appear. You can also give a <b>name</b> to the calculation for recognition. <br><br>Some advices about rigidity range setting practice are given in the <i><span class="text-info">Advices</span></i> section.
        </span>

        <span id="instances_help_text">
        <h4>Calculations</h4>
        After clicking <b>Calculate</b> button your calculation will appear on the list on the left. You can observe it's progress until it's completed. <br><br>

        When the calculation is complete it will be automatically <b>selected</b>. You can manually <i>select</i> and <i>unselect</i> calculations by <b>clicking</b> on their card.<br><br>

        If you've made a mistake or the calculation is not useful anymore, you can press <b>Delete</b> button on it's card.
        </span>

        <span id="rigidities_help_text">
        <h4>Rigidities and time graph</h4>
        For all selected calculations <b>time graph</b> and <b>rigidity ranges</b> will be drawn under the earth. Their ranges may not include all resulting rigidities. You can move viewed range by clicking on the <b>arrows</b>.<br><br><b>Hover your mouse</b> over the rigidity range. It will highlight pointed particle <b>energy</b> and it's <b>flight time.</b>
        </span>

        <span id="trajectories_help_text">
        <h4>Particle trajectories</h4>
        Clicking on the particles will draw their flying <b>trajectory.</b><br><br>Drawn traces are listed on the left. Click on the <i>[X]</i> to erase one. Hover your mouse over trace description, and other traces will be hidden.<br><br>

        You can mouse scroll to zoom, or mouse drag to rotate the earth.
        </span>

        <span id="advices_help_text">
        <h4>User advices</h4>
        Current host is not the fastest machine, so it's better to remember that higher models (+T96, +T02) can take a lot of time to calculate, so we encourage you to use precise step (0.001 GV) on a smaller ranges of rigidities that are more interesting, such as edges of allowed range, and before it use a bigger step for getting general picture.
        </span>

        <span id="physics_help_text">
        <h4>Physics</h4>
        <a href="Belov_cutoff2050_17jul.pdf" target="_blank" rel="noopener noreferrer">NMDB@Home Symposium presentation (pdf)</a>
        </span>

        <span id="credit_help_text">
        <h4>Credit</h4>
            Email for feedback and technical support: <b>cutoff@izmiran.ru</b><br><br>

            frontend: <b>Zobnin Georgii</b><br>
            backend: <b>Belov Semyon</b><br><br>

            calculations: <b>Gvozdevsky Boris</b><br><br>

            Pushkov Institute of Terrestrial Magnetism, Ionosphere and Radio Wave Propagation,
            IZMIRAN, Kaluzhskoe Hwy 4, Troitsk, Moscow, Russia<br><br>

            2019-2020
        </span>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
</body>

<script src="https://unpkg.com/popper.js/dist/umd/popper.min.js"></script>
<script src="./js/jquery-3.3.1.min.js"></script>
<script src="./js/bootstrap/bootstrap.min.js"></script>
<script src="./js/gl/three.min.js"></script>
<script src="./js/gl/gif/gif.js"></script>
<script src="./js/utils.js"></script>
<script src="./js/dimensions.js"></script>
<script src="./js/dropdown.js"></script>
<script src="./js/process.js"></script>
<script src="./js/login.js"></script>
<script src="./js/instance.js"></script>
<script src="./js/settings.js"></script>
<script src="./js/stations.js"></script>
<script src="./js/models.js"></script>
<script src="./js/penumbra.js"></script>
<script src="./js/earth/OrbitControls.js"></script>
<script src="./js/earth/recorder.js"></script>
<script src="./js/earth/trace.js"></script>
<script src="./js/earth/earth.js"></script>
<script src="./js/help.js"></script>
</html>
