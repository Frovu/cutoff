/*
// localhost settings
const ip = 'localhost';
const port = 3050;
const url = 'http://' + ip + ':' + port;
*/
// server settings
const url = '';

const status_update_ms = 200;   // default: 100
let uid;
let status_updater; // used by process.js to terminate status updates

function fetch_uid (settings) {
    fetch(url + 'submit', {
        method: 'POST',
        headers: { "Content-Type": "application/json" },
        body: settings
    }).then(res => res.text()).then(res_uid => {
        uid = res_uid;
        fetch_status();
    });
}

function fetch_status () {
    fetch(url + '' + uid + '/status', {
        method: 'GET',
        headers: { "Content-Type": "application/json" }
    }).then(res => {
		console.log(res);
		res.json().then(res_status => {
		console.log(res_status.status);
        if (res_status.status == 'processing') {
            let percentage = get_percent(res_status.precentage);
            update_process(percentage);
            status_updater = setTimeout(function() {
                fetch_status();
            }, status_update_ms);
        } else if (res_status.status == 'complete') {
            complete_process();
            fetch_data();
        } else if (res_status.status == 'failed') {
            console.error('Failed status.');
            console.error(data);
        }});
    });
}

function fetch_data () {
    fetch(uid + '/dat', {
        method: 'GET',
        headers: { "Content-Type": "application/json" }
    }).then(res => {
		console.log(res.text());
		res.json().then(received => {
        	data = received;
        	change_energy(settings.upper-settings.step);
   	 	});
	});
}

function fetch_trace (index) {
    fetch( uid + '/' + index, {
        method: 'GET',
        headers: { "Content-Type": "application/json" }
    }).then(res => res.json()).then(function (data) {
        //eraseAllPaths();    //if, of couse, we don't have to draw two paths
        let trace = data;
        trace.pop();    // useless last value from nowhere, so we just pop it
        draw_trace(trace);
    });
}
